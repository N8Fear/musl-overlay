diff -ur a/hdparm-9.39/Makefile b/hdparm-9.39/Makefile
--- a/hdparm-9.39/Makefile
+++ b/hdparm-9.39/Makefile
@@ -13,7 +13,7 @@
 CC ?= gcc
 STRIP ?= strip
 
-CFLAGS := -O2 -W -Wall -Wbad-function-cast -Wcast-align -Wpointer-arith -Wcast-qual -Wshadow -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations -fkeep-inline-functions -Wwrite-strings -Waggregate-return -Wnested-externs -Wtrigraphs $(CFLAGS)
+CFLAGS := -O2 -W -Wall -Wbad-function-cast -Wcast-align -Wpointer-arith -Wcast-qual -Wshadow -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations -fkeep-inline-functions -Wwrite-strings -Waggregate-return -Wnested-externs -Wtrigraphs -D _GNU_SOURCE $(CFLAGS)
 
 LDFLAGS = -s
 #LDFLAGS = -s -static
diff -ur a/hdparm-9.39/geom.c b/hdparm-9.39/geom.c
--- a/hdparm-9.39/geom.c
+++ b/hdparm-9.39/geom.c
@@ -16,7 +16,7 @@
 #include <dirent.h>
 #include <sys/stat.h>
 #include <sys/ioctl.h>
-#include <linux/types.h>
+#include <sys/types.h>
 #include <linux/fs.h>
 
 #include "hdparm.h"
diff -ur a/hdparm-9.39/hdparm.h b/hdparm-9.39/hdparm.h
--- a/hdparm-9.39/hdparm.h
+++ b/hdparm-9.39/hdparm.h
@@ -2,6 +2,7 @@
 
 //#undef __KERNEL_STRICT_NAMES
 #include <linux/types.h>
+#include <sys/stat.h>
 
 #if !defined(__GNUC__) && !defined(__attribute__)
 #define __attribute__(x)
diff -ur a/hdparm-9.39/sysfs.c b/hdparm-9.39/sysfs.c
--- a/hdparm-9.39/sysfs.c
+++ b/hdparm-9.39/sysfs.c
@@ -12,9 +12,10 @@
 #include <stdio.h>
 #include <fcntl.h>
 #include <errno.h>
+#include <limits.h>
 #include <dirent.h>
 #include <sys/stat.h>
-#include <linux/types.h>
+#include <sys/types.h>
 
 #include "hdparm.h"
 
